<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>VIS UI - Demo</title>

    <link media="all" type="text/css" rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link media="all" type="text/css" rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link media="all" type="text/css" rel="stylesheet" href="src/styles/base.css">

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"
            type="text/javascript"></script>
    <script src="https://cdn.datatables.net/r/dt/dt-1.10.8/datatables.min.js" type="text/javascript"></script>
    <script src="https://cdn.rawgit.com/ROMB/jquery-dialogextend/master/build/jquery.dialogextend.min.js"
            type="text/javascript"></script>
    <link media="all" type="text/css" rel="stylesheet"
          href="https://raw.githubusercontent.com/jquery/jquery-ui/master/themes/base/resizable.css">

    <!-- Underscore -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"
            type="text/javascript"></script>

    <!-- Leaflat -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdn.rawgit.com/Leaflet/Leaflet/master/dist/leaflet.css"/>


    <script type="application/javascript">
        $(function() {
            jQuery.getScript("src/js/loader.js?ver=" + Math.random(), function() {
                loadElements(function() {

                    (function() {

                        var has = function(obj, prop) {
                            return obj && obj[prop] !== undefined;
                        };

                        var getDiv = function() {
                            return $("<div/>");
                        };

                        var $formBody = getDiv();

                        /**
                         * Help methods
                         * */

                        var getIcon = function(name) {
                            return 'fa fa-' + name ;
                        };

                        var getIconButton = function(options) {

                            return {
                                type:  "button",
                                name:  options.name,
                                title: options.title,
                                cssClass :getIcon(options.icon),
                                click :options.click

                                /**
                                 *
                                 *  function(event){
                                 *
                                 *
                                 *  }
                                 *
                                 *
                                 * */



                            }
                        };

                        var getForm = function(obj, active) {
                            return {
                                type:     "form",
                                title:    obj.title,
                                children: obj.children,
                                active:   !!active
                            }
                        };

                        var cancelButton = function(clickHandler) {
                            return {
                                type:  "button",
                                name:  "cancelSave",
                                text:  "Cancel",
                                click: clickHandler
                            };
                        };

                        var saveButton = function(clickHandler) {
                            return {
                                type:  "button",
                                name:  "buttonSave",
                                text:  "Save",
                                click: clickHandler

                            };
                        };

                        //TODO: add mandatory flags

                        var general = {
                            title: "General",

                            children: [{
                                type:        "input",
                                name:        "inputQueryName",
                                placeholder: "Query name",
                                title:       "Query-name"
                            }, {
                                type:        "checkbox",
                                name:        "inputExtentOnly",
                                placeholder: "Extent only",
                                title:       "Extent only",
                                checked:     true

                            }, {
                                type:        "input",
                                name:        "inputStyle",
                                placeholder: "Style",
                                title:       "Style"
                            }, getIconButton({
                                name:  "buttonExtendInputStyle",
                                icon:  "bars",
                                title: ""
                            })]
                        };

                        var source = {
                            title:    "Source",
                            children: [{
                                type:        "select",
                                name:        "selectFeatureTyp",
                                placeholder: "Feature type",
                                title:       "Featuretype",
                                options: [ ]

                            }, getIconButton({
                                name:  "buttonExtendFeatureType",
                                icon:  "bars",
                                title: ""
                            })

                            ]
                        };

                        var fieldsTableHeader = [{
                            data:  'fieldName',
                            title: 'Field Name'
                        }, {
                            data:  'title',
                            title: 'Title'
                        }

                        ];

                        var fieldsTableDataGen = function(options) {
                            return {
                                title:     "<input type='text' placeholder='" + options.placeholder + "'>",
                                fieldName: options.fieldName
                            };
                        };

                        var fieldsTableData = [fieldsTableDataGen({
                            placeholder: "Name",
                            fieldName:   "name"
                        }), fieldsTableDataGen({
                            placeholder: "Beschreibung",
                            fieldName:   "description"
                        }), fieldsTableDataGen({
                            placeholder: "Entfernung",
                            fieldName:   "km"
                        })];

                        var fieldsTable = $('<div/>').resultTable({
                            lengthChange: false,
                            searching:    false,
                            info:         false,
                            columns:      fieldsTableHeader,
                            data:         fieldsTableData,
                            buttons: [{title:"", className:"fa fa-bars" }]


                        });

                        var fields = {
                            title:    "Fields",
                            children: [

                                {
                                    type: "label",
                                    text: "Add display field:",
                                    name: "labelAddDisplayField"
                                }, {
                                    type:  "label",
                                    title: "Field name",
                                    name:  "labelFieldName"
                                }, {
                                    type: "select",

                                    name: "selectFieldName"
                                }, {
                                    type:  "label",
                                    title: "Title (alias)",
                                    name:  "labelTitleAlias"
                                }, {
                                    type: "input",
                                    name: "inputTitleAlias"
                                }, getIconButton({
                                    name:  "buttonAddField",
                                    icon:  "plus",
                                    title: " Add fields"
                                }), {

                                    html: fieldsTable
                                }

                            ]
                        };

                        var constraintsTableHeader = [{
                            data:  'fieldName',
                            title: 'Field Name'
                        }, {
                            data:  'operator',
                            title: 'Operator'
                        }, {
                            data:  'value',
                            title: 'Value'
                        }, {
                            data:  'action',
                            title: 'Action'
                        }

                        ];

                        var constraintsTableDataGen = function(options) {

                            var selectOptions = "";

                            if(options.selectOptions) {
                                options.selectOptions.forEach(function(val, i) {
                                    selectOptions += '<option value="' + i + '">' + val + '</option>';
                                })
                            }

                            return {
                                fieldName: options.fieldName,
                                operator:  "<select>" + selectOptions + "</select>",
                                value:     "<input type='text' placeholder='" + options.placeholder + "'>",
                                action:    "<button class='button' title='" + options.fieldName + "'><i class='fa fa-bars'></i></button>"
                            };
                        };

                        var constraintsOperators = [">", "<", ">=", "<=", "==", "!=", "LIKE", "NOT LIKE"];

                        var constraintsTableData = [constraintsTableDataGen({
                            placeholder:   "mustermann",
                            fieldName:     "name",
                            selectOptions: constraintsOperators
                        }), constraintsTableDataGen({
                            placeholder:   "about",
                            fieldName:     "description",
                            selectOptions: constraintsOperators
                        }), constraintsTableDataGen({
                            placeholder:   20,
                            fieldName:     "km",
                            selectOptions: constraintsOperators
                        })];

                        var constraintsTable = $('<div/>').resultTable({
                            lengthChange: false,
                            searching:    false,
                            info:         false,
                            columns:      constraintsTableHeader,
                            data:         constraintsTableData
                        });

                        const constraints = {
                            title:    "Constraints",
                            children: [{
                                type:  "label",
                                title: "Add condition:",
                                name:  "labelAddCondition"
                            }, {
                                type:  "label",
                                title: "Field",
                                name:  "labelField"
                            }, {
                                type: "select",
                                name: "selectField"
                            }, {
                                type:  "label",
                                title: "Operator",
                                name:  "labelOperator"
                            }, {
                                type: "select",
                                name: "selectOperator"
                            }, {
                                type:  "label",
                                title: "Value",
                                name:  "labelValue"
                            }, {
                                type: "input",
                                name: "inputConditionValue"
                            }, getIconButton({
                                name:  "buttonAddCondition",
                                icon:  "plus",
                                title: " Add Condition",
                                click:function(e) {
                                    var el = $(e.currentTarget);
                                    var form = el.closest('.popup-dialog');



                                    e.preventDefault();

                                 }
                            }), {
                                html: constraintsTable
                            }

                            ]
                        };

                        $formBody.generateElements({
                            type:     "tabs",
                            children: [getForm(general, true), getForm(source), getForm(fields), getForm(constraints)]
                        });

                        $formBody.popupDialog({
                            title:       "",
                            maximizable: true,
                            width:       "500px",
                            buttons:     [cancelButton(function(e) {
                                var popup = $(e.currentTarget).closest(".ui-").find(".popup-");
                                console.log(popup.formData());
                                popup.popup('close');
                            }), saveButton()]

                        });

                    })();

                });
            })
        });
    </script>

    <style type="text/css" media="all">
        html, body {
            height: 100%;
            overflow: hidden;
        }
    </style>
</head>
<body>
</body>
</html>